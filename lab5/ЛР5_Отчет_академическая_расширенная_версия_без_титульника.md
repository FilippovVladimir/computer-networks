
# ЛАБОРАТОРНАЯ РАБОТА №5  
## Изучение работы протоколов стека TCP/IP с помощью Wireshark

# ВВЕДЕНИЕ

Целью данной лабораторной работы является подробное изучение принципов функционирования протоколов стека TCP/IP посредством анализа сетевого трафика, перехваченного с использованием программы Wireshark.  
В процессе выполнения работы необходимо научиться:

- осуществлять захват сетевого трафика;
- анализировать статистику передаваемых пакетов;
- применять фильтры для отбора определённых типов трафика;
- исследовать структуру протоколов ICMP и TCP;
- анализировать механизм установления TCP‑соединения.

# 1. НАЧАЛО РАБОТЫ С WIRESHARK

## 1.1 Запуск Wireshark

После запуска программы Wireshark был выбран активный сетевой интерфейс Ethernet.

![Рисунок 1.1 — Запуск Wireshark](fig1_1_wireshark_start.png)  
*Описание: выбор сетевого интерфейса для захвата пакетов.*

В параметрах захвата был установлен лимит объёма собираемого трафика — 5 МБ.

![Рисунок 1.2 — Параметры захвата](fig1_2_capture_settings.png)  
*Описание: ограничение размера захвата.*

## 1.2 Статистика

Во время захвата был открыт веб‑сайт https://gaga.ru (IP‑адрес 37.77.107.212), а также были выполнены различные действия в браузере.

В разделе Statistics → Conversations было обнаружено, что наибольшая активность наблюдалась между локальным адресом 192.168.0.2 и удалённым сервером 37.230.113.18.

![Рисунок 1.3 — Статистика IPv4](fig1_3_ipv4_stats.png)

Было выявлено устройство 192.168.0.9, осуществившее наибольшее количество широковещательных рассылок на адрес 192.168.0.255.

![Рисунок 1.4 — Broadcast‑пакеты](fig1_4_broadcast.png)

Наиболее активным TCP‑портом стал порт 443 (HTTPS), что объясняется использованием защищённого соединения.

![Рисунок 1.5 — Активность TCP‑портов](fig1_5_tcp_port.png)

В разделе I/O Graphs были построены графики интенсивности TCP и UDP трафика.

![Рисунок 1.6 — График TCP и UDP](fig1_6_io_graph.png)

После запуска мультиплеерной игры Valorant наблюдалось значительное увеличение UDP‑трафика.

![Рисунок 1.7 — UDP при игре](fig1_7_udp_game.png)

Также была построена диаграмма связей HTTPS‑трафика (Flow Graph).

![Рисунок 1.8 — Flow Graph](fig1_8_flow_graph.png)

## 1.3 Фильтры

Был создан фильтр для отбора HTTP‑трафика браузера:

```
(ip.src == 192.168.0.2 and tcp.srcport > 1024 and tcp.dstport == 80) 
or (ip.dst == 192.168.0.2 and tcp.dstport > 1024 and tcp.srcport == 80)
```

Фильтр для всех кадров Ethernet, отправленных с сетевого интерфейса:

```
eth.src == 7C-10-C9-23-47-BC
```

Фильтр для широковещательных сообщений:

```
eth.dst == ff:ff:ff:ff:ff:ff || ip.dst == 192.168.0.255
```

Были выделены три типа широковещательных рассылок:

- ARP — разрешение IP в MAC;
- NBNS — разрешение NetBIOS‑имён;
- UDP broadcast — обнаружение устройств.

![Рисунок 1.9 — Разные broadcast‑пакеты](fig1_9_broadcast_types.png)

ARP‑запрос к шлюзу 192.168.0.1:

![Рисунок 1.10 — ARP‑запрос](fig1_10_arp.png)

# 2. СБОР И АНАЛИЗ ДАННЫХ ПРОТОКОЛА ICMP

## 2.1 ICMP по локальным узлам

IP компьютера: 192.168.0.2  
IP телефона: 192.168.0.7

Был выполнен ping с телефона на компьютер.

![Рисунок 2.1 — ICMP Echo](fig2_1_icmp_local.png)

В кадре Ethernet II отображаются MAC‑адреса источника и назначения.

![Рисунок 2.2 — MAC‑адреса](fig2_2_ethernet.png)

ПК определяет MAC‑адрес через протокол ARP.

```
arp -a
```

![Рисунок 2.4 — ARP‑кэш](fig2_4_arp_cache.png)

## 2.2 ICMP по удалённым узлам

Были пропингованы внешние сайты:

euronews.com — 52.50.243.46  
bbc.com — 151.101.192.81  
cnn.com — 151.101.131.5  

MAC‑адрес назначения во всех случаях совпадал и соответствовал шлюзу 192.168.0.1.

![Рисунок 2.5 — MAC шлюза](fig2_5_router_mac.png)

Это объясняется тем, что для взаимодействия с внешними сетями используется MAC‑адрес маршрутизатора.

# 3. АНАЛИЗ ПОЛЕЙ TCP

Было установлено FTP‑соединение с сервером преподавателя.

Первая датаграмма содержит флаг SYN=1 — начало TCP‑сеанса.

![Рисунок 3.1 — SYN‑пакет](fig3_1_syn.png)

## Таблица 3.1 — Первая датаграмма

| Поле | Значение |
|------|-----------|
| IP‑источник | 192.168.0.2 |
| IP‑назначение | 109.167.241.225 |
| Порт источник | 53707 |
| Порт назначение | 21 |
| Seq | 0 |
| Ack | 0 |
| Заголовок | 32 байта |
| Window | 64240 |

Ответ сервера (SYN‑ACK):

![Рисунок 3.2 — SYN‑ACK](fig3_2_synack.png)

## Таблица 3.2 — Вторая датаграмма

| Поле | Значение |
|------|-----------|
| IP‑источник | 109.167.241.225 |
| IP‑назначение | 192.168.0.2 |
| Порт источник | 21 |
| Порт назначение | 53707 |
| Seq | 0 |
| Ack | 1 |
| Заголовок | 32 байта |
| Window | 65535 |

Третья датаграмма — ACK:

![Рисунок 3.3 — ACK](fig3_3_ack.png)

## Таблица 3.3 — Третья датаграмма

| Поле | Значение |
|------|-----------|
| IP‑источник | 192.168.0.2 |
| IP‑назначение | 109.167.241.225 |
| Порт источник | 53707 |
| Порт назначение | 21 |
| Seq | 1 |
| Ack | 1 |
| Заголовок | 20 байт |
| Window | 1025 |

Таким образом реализуется трёхстороннее рукопожатие TCP: SYN → SYN‑ACK → ACK.

# ЗАКЛЮЧЕНИЕ

В ходе выполнения лабораторной работы был изучен стек TCP/IP посредством анализа перехваченного трафика в Wireshark. Были рассмотрены протоколы Ethernet, ARP, ICMP и TCP, а также проанализирован механизм установления TCP‑соединения.

Поставленные цели были достигнуты: получены практические навыки анализа сетевого трафика и применения фильтров Wireshark.
