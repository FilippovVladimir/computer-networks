
# ЛАБОРАТОРНАЯ РАБОТА №4  
## Организация отказоустойчивой сети на основе коммутаторов. Протоколы STP и EtherChannel

# ВВЕДЕНИЕ

Целью данной лабораторной работы является изучение принципов построения отказоустойчивых сетей на основе коммутаторов второго уровня, а также практическое освоение протоколов STP (Spanning Tree Protocol), RSTP (Rapid Spanning Tree Protocol) и технологии EtherChannel.

В ходе выполнения работы необходимо:

- продемонстрировать работу протокола STP;
- определить корневой коммутатор и роли портов;
- сравнить работу STP и RSTP по времени сходимости;
- выполнить настройку статического агрегирования каналов;
- реализовать динамическое агрегирование с использованием протокола LACP;
- проверить распределение трафика по объединённым каналам.

# 1. ТЕСТИРОВАНИЕ ПРОТОКОЛОВ STP И RSTP

## 1.1 Протокол STP

Для демонстрации работы протокола STP были соединены коммутаторы первой и третьей сетей: к маршрутизатору M1 по порту FastEthernet0/24 и к M7 по порту GigabitEthernet0/1.

Схема сети представлена ниже.

![Рисунок 1.1 — Схема сети для STP](fig1_1_stp_scheme.png)  
*Описание: соединение коммутаторов с избыточным каналом.*

На схеме заметен оранжевый индикатор на одном из соединений. Это означает, что канал физически активен, но логически заблокирован протоколом STP для предотвращения петель.

Для определения корневого коммутатора была использована команда:

```
show spanning-tree
```

![Рисунок 1.2 — Вывод show spanning-tree](fig1_2_show_stp.png)  
*Описание: определение root bridge по роли портов.*

В выводе видно, что интерфейсы с ролью "root" направлены в сторону M7, следовательно, именно M7 является корневым коммутатором.

Корневой коммутатор выбирается на основе Bridge ID, который состоит из приоритета и MAC-адреса. При одинаковом приоритете выбирается устройство с наименьшим MAC-адресом.

MAC-адреса коммутаторов были проверены командой:

```
show version
```

Было установлено, что у M7 наименьший MAC-адрес, что подтверждает его выбор в качестве root bridge.

Резервный порт был определён на M1 — это порт Fa0/2.

![Рисунок 1.3 — Резервный порт](fig1_3_blocked_port.png)  
*Описание: порт в состоянии blocking.*

Была проверена передача пакета от компьютера у M1 к устройству в сети M2.

![Рисунок 1.4 — Путь пакета через root](fig1_4_packet_path.png)  
*Описание: трафик проходит через корневой коммутатор.*

Пакет передаётся через M7, так как прямой путь заблокирован.

Далее был отключён интерфейс Gi0/1. После этого трафик начал передаваться через резервный порт.

![Рисунок 1.5 — Путь через резервный порт](fig1_5_backup_path.png)  
*Описание: активация резервного канала.*

Затем был отключён интерфейс Fa0/1 между M2 и M7. Маршрут передачи остался неизменным.

![Рисунок 1.6 — Повторный путь через резерв](fig1_6_same_path.png)  
*Описание: подтверждение отказоустойчивости.*

Таким образом, STP обеспечивает предотвращение петель и восстановление связи при отказе основного канала.

## 1.2 Протокол RSTP

Согласно варианту 10 было необходимо соединить коммутаторы M2 и M7 через порт Fa0/24.

Схема работы показана ниже.

![Рисунок 1.7 — Работа STP на двух коммутаторах](fig1_7_show_span.png)  
*Описание: вывод spanning-tree на обоих коммутаторах.*

M7 остался корневым коммутатором, а один из портов стал резервным.

Для сравнения времени восстановления связи выполнялось отключение и повторное включение портов.

При использовании STP время восстановления составляло примерно 30 секунд.

Протокол был изменён на RSTP командой:

```
spanning-tree mode rapid-pvst
```

![Рисунок 1.8 — Переход на RSTP](fig1_8_rstp.png)  
*Описание: смена режима STP на rapid-pvst.*

После включения RSTP время сходимости сократилось до 1–2 секунд, что значительно быстрее по сравнению с классическим STP.

# 2. ТЕСТИРОВАНИЕ ПРОТОКОЛА ETHERCHANNEL

## 2.1 Статическое агрегирование

Согласно варианту 10 (10 % 3 = 1) агрегирование выполняется между M1 и M7. Было принято решение объединить три канала (порты Fa0/22, Fa0/23 и Fa0/24).

Схема сети представлена ниже.

![Рисунок 2.1 — Схема для статического агрегирования](fig2_1_static_scheme.png)  
*Описание: три физических канала между коммутаторами.*

Перед настройкой все интерфейсы были отключены.

Агрегирование выполнялось командой:

```
channel-group 3 mode on
```

![Рисунок 2.2 — Настройка channel-group](fig2_2_channel_group.png)  
*Описание: объединение интерфейсов в группу.*

Состояние EtherChannel проверено командой:

```
show etherchannel summary
```

![Рисунок 2.3 — Состояние EtherChannel](fig2_3_ether_summary.png)  
*Описание: активный port-channel.*

Информация о port-channel:

```
show etherchannel port-channel
```

![Рисунок 2.4 — Port-channel](fig2_4_port_channel.png)  
*Описание: параметры логического интерфейса.*

Была выполнена отправка трёх пакетов с разных устройств.

![Рисунок 2.5 — Распределение трафика](fig2_5_packets.png)  
*Описание: пакеты распределяются по разным физическим каналам.*

Таким образом, нагрузка распределяется между всеми участниками агрегированного канала.

## 2.2 Динамическое агрегирование LACP

В данной части работы каждый коммутатор второго уровня был подключён к коммутатору третьего уровня.

Схема представлена ниже.

![Рисунок 2.6 — Схема динамического агрегирования](fig2_6_dynamic_scheme.png)  
*Описание: подключение нескольких коммутаторов к L3-свитчу.*

На коммутаторе третьего уровня интерфейсы были переведены в режим trunk и настроены на использование 802.1Q.

На коммутаторах второго уровня порты Fa0/23 и Fa0/24 были объединены в группы с использованием протокола LACP:

```
channel-group 1 mode active
```

![Рисунок 2.7 — Настройка LACP на L3](fig2_7_l3_config.png)  
*Описание: конфигурация агрегирования на коммутаторе третьего уровня.*

![Рисунок 2.8 — Настройка LACP на L2](fig2_8_l2_config.png)  
*Описание: объединение интерфейсов на L2-коммутаторе.*

Состояние EtherChannel проверено:

```
show etherchannel summary
```

![Рисунок 2.9 — Состояние LACP](fig2_9_lacp_summary.png)  
*Описание: активные агрегированные каналы.*

Информация о port-channel:

![Рисунок 2.10 — Port-channel LACP](fig2_10_lacp_port_channel.png)  
*Описание: логический интерфейс LACP.*

При тестировании трафика было замечено распределение пакетов между портами Fa0/23 и Fa0/24.

![Рисунок 2.11 — Пакет на Fa0/23](fig2_11_packet23.png)  
*Описание: передача пакета по первому физическому каналу.*

![Рисунок 2.12 — Пакет на Fa0/24](fig2_12_packet24.png)  
*Описание: передача пакета по второму физическому каналу.*

Это подтверждает корректную работу динамического агрегирования.

# ЗАКЛЮЧЕНИЕ

В ходе выполнения лабораторной работы были протестированы протоколы STP и RSTP, исследована их работа при наличии избыточных каналов и сравнено время восстановления соединения.

Также была выполнена настройка технологии EtherChannel как в статическом режиме, так и с использованием протокола LACP. Было подтверждено распределение трафика между объединёнными каналами.

Поставленные цели по изучению отказоустойчивых механизмов на основе коммутаторов были достигнуты.
